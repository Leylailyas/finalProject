<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="../assets/custom/images/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <link rel="stylesheet" type="text/css" href="../assets/common/toastify/toastify.min.css">
    <link rel="stylesheet" href="../assets/common/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/custom/css/style.css">
    <link rel="stylesheet" href="../assets/custom/css/blog.css">
    <title>openSIS | Blog Detail</title>
</head>
<body>
<header>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/">
                <img src="../assets/custom/images/logo.png" alt="">
            </a>
            <div class="mobile-right">
                <a href="#">Ödənişsiz sınaq</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarSupportedContent"
                        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                           aria-expanded="false">
                            Proqram təminatımız
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Özəllikləri</a></li>
                            <li><a class="dropdown-item" href="#">Memarlıq</a></li>
                            <li><a class="dropdown-item" href="#">İnteqrasiyalar</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                           aria-expanded="false">
                            Xidmətlər
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">İcra</a></li>
                            <li><a class="dropdown-item" href="#">Təlim</a></li>
                            <li><a class="dropdown-item" href="#">Fərdi inteqrasiya</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="http://google.com">Nəyə görə biz ?</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                           aria-expanded="false">
                            Resurslar
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="index.html">Bloqlar</a></li>
                            <li><a class="dropdown-item" href="#">Dəstək Portalı (Proqram təminatı xidməti)</a></li>
                            <li><a class="dropdown-item" href="#">Dəstək Portalı (Klassik)</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Qiymətlər</a>
                    </li>
                </ul>
                <div class="right-menu">
                    <ul>
                        <li>
                            <a href="../login.html">Giriş</a>
                        </li>
                        <li>
                            <a href="#">Ödənişsiz sınaq</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
</header>
<div class="blog-detail-page">
    <div class="container">
        <div class="loading">
            <div class="d-flex justify-content-center">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
        <div class="post">
            <div class="post-header">
                <div class="left">
                    <a href="index.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
                            <path fill="currentColor"
                                  d="m7.85 13l2.85 2.85q.3.3.288.7t-.288.7q-.3.3-.712.313t-.713-.288L4.7 12.7q-.3-.3-.3-.7t.3-.7l4.575-4.575q.3-.3.713-.287t.712.312q.275.3.288.7t-.288.7L7.85 11H19q.425 0 .713.288T20 12q0 .425-.288.713T19 13z"/>
                        </svg>
                    </a>
                </div>
                <div class="right">
                    <h4>
                        SCHOOL MANAGEMENT
                    </h4>
                    <h2></h2>
                    <ul class="details">
                        <li class="post-author">
                            <i class="fa-solid fa-user"></i>
                            <span></span>
                        </li>
                        <li class="post-created-at">
                            <i class="fa-solid fa-calendar-days"></i>
                            <span></span>
                        </li>
                        <li class="post-views">
                            <i class="fa-solid fa-eye"></i>
                            Baxış sayı: <span></span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="post-image">
                <img src="https://assets-global.website-files.com/6228b11d9d3281d0a792fa09/6553add56ede92de7dc62d0c_openSIS%20-%20Student%20Information%20System.png"
                     alt="">
            </div>
            <div class="post-body">
                <div class="social-links">
                    <ul>
                        <li>
                            Share
                        </li>
                        <li>
                            <a href="#" id="fb">
                                <img src="https://platform-cdn.sharethis.com/img/facebook.svg" alt="">
                            </a>
                        </li>
                        <li>
                            <a href="#" id="x">
                                <img src="https://platform-cdn.sharethis.com/img/twitter.svg" alt="">
                            </a>
                        </li>
                        <li>
                            <a href="#" id="share">
                                <img src="https://platform-cdn.sharethis.com/img/sharethis.svg" alt="">
                            </a>
                        </li>
                        <li>
                            <a href="#" id="linkedin">
                                <img src="https://platform-cdn.sharethis.com/img/linkedin.svg" alt="">
                            </a>
                        </li>
                        <li>
                            <a href="#" id="wp">
                                <img src="https://platform-cdn.sharethis.com/img/whatsapp.svg" alt="">
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="post-content">
                    <h3></h3>
                </div>
            </div>
        </div>
        <div class="latest-posts">
            <h3 class="section-title">Sonuncu postlar</h3>
            <div id="latest-posts" class="row">

            </div>
        </div>
    </div>
</div>


<footer>
    <div class="top">
        <div class="container">
            <div class="columns">
                <div class="column">
                    <h3>
                        Sosial media kanalınız vasitəsilə bizimlə əlaqə saxlayın
                    </h3>
                    <ul class="social-links">
                        <li>
                            <a href="#"><img src="../assets/custom/images/sosial-media/fb.svg" alt=""></a>
                        </li>
                        <li>
                            <a href="#"><img src="../assets/custom/images/sosial-media/x.svg" alt=""></a>
                        </li>
                        <li>
                            <a href="#"><img src="../assets/custom/images/sosial-media/insta.svg" alt=""></a>
                        </li>
                        <li>
                            <a href="#"><img src="../assets/custom/images/sosial-media/in.svg" alt=""></a>
                        </li>
                        <li>
                            <a href="#"><img src="../assets/custom/images/sosial-media/yt.svg" alt=""></a>
                        </li>
                    </ul>
                    <form class="start-trial-container">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" placeholder="İş mail-inizi daxil edin"
                                   aria-label="İş mail-inizi daxil edin" aria-describedby="button-addon2">
                            <button class="btn" type="button" id="button-addon">Pulsuz sınağa
                                başlayın
                            </button>
                        </div>
                    </form>
                </div>
                <div class="column">
                    <ul>
                        <li class="column-name">
                            Özəlliklər
                        </li>
                        <li>
                            <a href="#">Tələbə məlumatları</a>
                        </li>
                        <li>
                            <a href="#">Qəbullar</a>
                        </li>
                        <li>
                            <a href="#">Planlaşdırma</a>
                        </li>
                        <li>
                            <a href="#">Davamiyyət</a>
                        </li>
                        <li>
                            <a href="#">Qiymətləndirmə</a>
                        </li>
                        <li>
                            <a href="#">Akademik Analitika</a>
                        </li>
                        <li>
                            <a href="#">Bütün özəlliklərə bax</a>
                        </li>
                    </ul>
                </div>
                <div class="column">
                    <ul>
                        <li class="column-name">
                            Xidmətlər
                        </li>
                        <li>
                            <a href="#">İcra</a>
                        </li>
                        <li>
                            <a href="#">Fərdi inteqrasiya</a>
                        </li>
                        <li>
                            <a href="#">Təlim</a>
                        </li>
                        <li>
                            <a href="#"><span>Niyə openSIS ?</span></a>
                        </li>
                        <li>
                            <a href="#"><span>Qiymətlər</span></a>
                        </li>
                    </ul>
                </div>
                <div class="column">
                    <ul>
                        <li class="column-name">
                            Resurslar
                        </li>
                        <li>
                            <a href="#">Dəstək</a>
                        </li>
                        <li>
                            <a href="#">İnteqrasiya</a>
                        </li>
                        <li>
                            <a href="#"><span>Bizimlə əlaqə</span></a>
                        </li>
                        <li>
                            <a href="#"><span>Satışlarla əlaqə</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="middle">
        <div class="container">
            <div class="left">
                Copyright © Open Solutions for Education, Inc. (<a href="#">OS4Ed</a>). All Rights Reserved.
            </div>
            <ul class="right">
                <li>
                    <a href="#">Məxfilik siyasəyi</a>
                </li>
                <li>
                    <a href="#">Xidmət Şərtləri</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="bottom">
        <div class="container">
            <ul>
                <li class="column-name">
                    Özəlliklər
                </li>
                <li>
                    <a href="#">Tələbə məlumatları</a>
                </li>
                <li>
                    <a href="#">Qəbullar</a>
                </li>
                <li>
                    <a href="#">Planlaşdırma</a>
                </li>
                <li>
                    <a href="#">Davamiyyət</a>
                </li>
                <li>
                    <a href="#">Qiymətləndirmə</a>
                </li>
                <li>
                    <a href="#">Akademik Analitika</a>
                </li>
                <li>
                    <a href="#">Bütün özəlliklərə bax</a>
                </li>
            </ul>
        </div>
    </div>
</footer>
<script src="../assets/common/jquery/jquery-3.7.1.min.js"></script>
<script src="../assets/common/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../assets/common/toastify/toastify.js"></script>
<script src="../assets/common/axios/axios.min.js"></script>
<script src="../assets/custom/js/helpers.js"></script>
<script src="../assets/custom/js/custom.js"></script>
<script>
    $(function () {
        const queryString = window.location.search

        const urlParams = new URLSearchParams(queryString)

        const postId = urlParams.get('id')

        let post = {}
        let users = []
        let posts = []

        function setPageLoading(action = true) {
            if (action) {
                $('.blog-detail-page .loading').show()
                $('.blog-detail-page .post, .blog-detail-page .latest-posts').hide()
            } else {
                $('.blog-detail-page .loading').hide()
                $('.blog-detail-page .post, .blog-detail-page .latest-posts').show()
            }
        }

        function findAuthor(userId) {

            let author = users.find(u => u.id == userId)
            if (!author) {
                author = {
                    name: 'Naməlum',
                    surname: ''
                }
            }

            return author
        }

        async function getPost() {
            setPageLoading(true)
            await customAxios.get('/posts/' + postId)
                .then(res => {
                    post = res.data
                    if (post.status == 'pending') {
                        redirecTo('index.html')
                    }
                })
                .catch(err => {
                    showError('Xəta')
                    console.log('err', err)
                    redirecTo('index.html')
                })

            await customAxios.get('/posts')
                .then(res => {
                    posts = res.data.filter(p => p.status == 'published' && p.id != postId)
                    // posts = res.data
                })
                .catch(err => {
                    showError('Xəta')
                    console.log('err', err)
                })

            await customAxios.get('/users')
                .then(res => {
                    users = res.data
                })
                .catch(err => {
                    showError('Xəta ! Post tapılmadı')
                    console.log('err', err)
                })
                .finally(() => setPageLoading(false))


            setPost()
            setLatestPosts()
            updatePostViews()
        }

        function setPost() {

            const author = findAuthor(post.user_id)

            const dateObject = new Date(post.created_at);
            const formattedDate = dateObject.toLocaleString('tr-TR', {
                day: 'numeric',
                month: 'numeric',
                year: 'numeric',
            })


            $('.blog-detail-page .post .right h2').text(post.title)
            $('.blog-detail-page .post .details .post-author span').text(`${author.name} ${author.surname}`)
            $('.blog-detail-page .post .details .post-created-at span').text(formattedDate)
            $('.blog-detail-page .post .details .post-views span').text(post.views)
            $('.blog-detail-page .post .post-image img').attr('src', post.image)
            $('.blog-detail-page .post .post-content h3').text(post.title)
            $('.blog-detail-page .post .post-content').append(post.text)

        }

        function setLatestPosts() {

            const latestPosts = posts.slice(0, 9)

            let latestPostsHtml = ''

            latestPosts.map(post => {


                const author = findAuthor(post.user_id)
                const postUrl = `detail.html?id=${post.id}`
                const dateObject = new Date(post.created_at);
                const formattedDate = dateObject.toLocaleString('tr-TR', {
                    day: 'numeric',
                    month: 'numeric',
                    year: 'numeric',
                })

                latestPostsHtml += `
                <div class="col-lg-4 col-md-6 col-12">
                    <a href="${postUrl}" class="post">
                <span class="post-image">
                    <img src="${post.image}"
                         alt="">
                </span>
                        <span class="post-content">
                        <h4 class="post-category blue">
                            Post category 1
                        </h4>
                        <h3 class="post-title">
                        ${post.title}
                        </h3>
                                <ul class="post-footer">
                                    <li class="post-author">
                                        <i class="fa-solid fa-user"></i>
                                        <span>
                                        ${author.name} ${author.surname}
                                </span>
                                    </li>
                                    <li class="post-created-at">
                                        <i class="fa-solid fa-calendar-days"></i>
                                        <span>
                                        ${formattedDate}
                                </span>
                                    </li>
                                </ul>
                        </span>
                    </a>
                </div>
                `
            })


            $('#latest-posts').html(latestPostsHtml)

        }

        function updatePostViews() {
            customAxios.put('/posts/' + postId, {
                ...post,
                views: parseInt(post.views) + 1
            })
        }
        getPost()
    })
</script>
</body>
</html>